---
title: 'DATA 606:  Final Project'
author: "Walt Wells, Fall 2016"
output:
  html_document:
    theme: lumen
    highlight: zenburn
    css: ../custom.css
    toc: true
    toc_float: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1 - Introduction:

### Research question 

In this project we will examine campaign expenditures for the 2016 US presidential election.   We will concentrate on the two major party nominees, and will look at expenditures by the month, starting in Feb 2016.   

Because of the nuances of campaign finance law, while we will be able to see the intake for the campaigns, we will not be able to see fund intake for the independent PACs.   As a result, we will look at expenditures.   

The summary stats by month for each campaign are already available.  We will tidy the independant PAC data to create monthy summary expenditures for groups that favor or oppose the two major party nominees. 

Our goal is to compare monthly expenditures for the campaign and for PACs across the two candidates.   We will further attempt to use the "sup_opp" variable in the PAC data to divide PAC expenditures across "negative" or "positive" efforts. 

__NOTE:__   Before the project is due, there should be another month release of the data.   We will update our collected dataset accordingly.   The data cleaning methods we build are expected to work well with new observations.   Three cheers for reproduceable research!

__NOTE2:__ A secondary study I may choose to conduct will be to further explore PAC data by the "pur" or "purpose of expenditure" category and review what PACs were spending their money on.   This would require some superior data cleaning efforts, as this var currently has 1362 levels with items as varied as "Robocalls" and "Taxi from event".   

### Environment Prep

```{r, warning=FALSE, message=FALSE}
if (!require('dplyr')) install.packages('dplyr')
if (!require('stringr')) install.packages('stringr')
if (!require('ggplot2')) install.packages('ggplot2')
```

## Part 2 - Data:

```{r, cache=TRUE}
# load data
camp <- read.csv("FEC_campaign_summary.csv")
pac <- read.csv("FEC_independent-expenditure.csv")
```


### Cases 

In our raw data, there are of the campaign `r nrow(camp)` data and `r nrow(pac)` of the PAC data.  

Really, we'll only want the monthly observations for our two candidates so once the data is cleaned and merged into a long format dataset, I would expect the number of cases = n months * 6, where 6 represents ClintonCampaign, ProClintonPAC, AntiClintonPAC, TrumpCampaign, ProTrumpPAC, AntiTrumpPAC. 

### Data collection 

**Describe the method of data collection.**

The data is delivered to the FEC and redistributed to the public as part of disclosure law. 

"The Federal Election Commission (FEC) is an independent regulatory agency established in 1975 to administer and enforce the Federal Election Campaign Act (FECA). That statute limits the sources and amounts of the contributions used to finance federal elections, requires public disclosure of campaign finance information and--in tandem with the Primary Matching Payment Act and the Presidential Election Campaign Fund Act--provides for the public funding of Presidential elections. For more information on the FEC's role in regulating federal elections, see the brochure "The FEC and the Federal Campaign Finance Law." - From the [FEC Site](http://www.fec.gov/about.shtml)

### Type of study 

**What type of study is this (observational/experiment)?**

This is an observational data study.

### Data Source 

**If you collected the data, state self-collected. If not, provide a citation/link.**

Data is source from is publicly available datasets from the [Federal Election Commission](http://fec.gov/about.shtml).   The data we will examine includes summary data on the 2016 US Presidential election from both the [campaigns](http://fec.gov/disclosurep/PDownload.do?candId=P00000001&electionYr=2016&candNmTitle=All%20Candidates&downloadComeFrom=pNational) and [independant groups or PACs](http://www.fec.gov/data/IndependentExpenditure.do?format=html&cf=superPAC).

### Response 

**What is the response variable, and what type is it (numerical/categorical)?**

The response variable will be the expenditure by the month.   This will be a numerical variable. 

### Explanatory 

**What is the explanatory variable, and what type is it (numerical/categorival)?**

We expect to have a few explanatory variables, candidate (Categorical), whether it is campaign or PAC (Categorical), and month (Categorical).   As we delve deeper, we may wish to add a few additional variables.


## Part 3 - Exploratory data analysis:

### Campaign Data Prep

```{r}
#subset to DT and HC
campsub <- filter(camp, CMTE_NM =="HILLARY FOR AMERICA" | CMTE_NM =="DONALD J. TRUMP FOR PRESIDENT, INC.") %>% 
    filter(str_detect(RPT_TP, "M")) %>% 
    arrange(CMTE_NM, RPT_TP) %>% 
    select(CMTE_NM, RPT_TP, TTL_DISB_SUM_PAGE_PER) %>% 
    droplevels()

#change to month
campsub$RPT_TP <- as.character(campsub$RPT_TP)
campsub$RPT_TP[campsub$RPT_TP == "M2"] <- "Feb"
campsub$RPT_TP[campsub$RPT_TP == "M3"] <- "Mar"
campsub$RPT_TP[campsub$RPT_TP == "M4"] <- "Apr"
campsub$RPT_TP[campsub$RPT_TP == "M5"] <- "May"
campsub$RPT_TP[campsub$RPT_TP == "M6"] <- "Jun"
campsub$RPT_TP[campsub$RPT_TP == "M7"] <- "Jul"
campsub$RPT_TP[campsub$RPT_TP == "M8"] <- "Aug"
campsub$RPT_TP[campsub$RPT_TP == "M9"] <- "Sep"
campsub$RPT_TP[campsub$RPT_TP == "M10"] <- "Oct"
campsub$RPT_TP <- factor(campsub$RPT_TP, level=
                             c("Feb", "Mar", "Apr", "May", "Jun",
                               "Jul", "Aug", "Sep", "Oct"))
```

#### Exploratory Campaign Data Plot

```{r}
#plot
ggplot(campsub, aes(x=RPT_TP, y=TTL_DISB_SUM_PAGE_PER,
                    group=CMTE_NM, colour=CMTE_NM)) + 
    geom_line() + ylab("Total Disbursements") + xlab("")
```

### PAC Data Prep

#### Initial clean, subset of PAC data

Below we will begin to clean, subset, and rename to find PACs associated with HRC and DJT, noting whether they support or oppose a candidate.

```{r}
# ready numeric vector
pac$expenditure <- str_replace_all(as.character(pac$exp_amo), fixed("$"), "")
pac$expenditure <- as.numeric(str_replace_all(pac$expenditure, ',', ''))

# droplevels
pac$can_nam <- as.character(pac$can_nam)
pac$can_nam <- tolower(pac$can_nam)
pac$spe_nam <- tolower(pac$spe_nam)

# subset only those that refer to HRC
pacsubHC <- pac[grepl("inton|hil", pac$can_nam), ]
pacsubHC <- pacsubHC[!grepl("kirk|james|george", pacsubHC$can_nam), ]
pacsubHC$org[pacsubHC$sup_opp == "Oppose"] <- "HRC_Oppose"
pacsubHC$org[pacsubHC$sup_opp == "Support"] <- "HRC_Support"

# what's missing?
rmhrc <- pacsubHC[!complete.cases(pacsubHC$org),]
pacsubHC <- pacsubHC[complete.cases(pacsubHC$org),]
rmhrc$org[rmhrc$can_par_aff == "Dem"] <- "HRC_Support"
rmhrc <- rmhrc[complete.cases(rmhrc$org),]
pacsubHC <- rbind(pacsubHC, rmhrc)

# subset only those that refer to DJT
pacsubDT <- pac[grepl("trump", pac$can_nam),]
pacsubDT$org[pacsubDT$sup_opp == "Oppose"] <- "DJT_Oppose"
pacsubDT$org[pacsubDT$sup_opp == "Support"] <- "DJT_Support"

# what's missing?
rmdjt <- pacsubDT[!complete.cases(pacsubDT$org),]
pacsubDT <- pacsubDT[complete.cases(pacsubDT$org),]
rmdjt$org[rmdjt$can_par_aff == "Rep"] <- "DJT_Support"
rmdjt <- rmdjt[complete.cases(rmdjt$org),]
pacsubDT <- rbind(pacsubDT, rmdjt)

# combine, subset
pacsub <- rbind(pacsubHC, pacsubDT)
pacsub <- select(pacsub, org, spe_nam, rec_dat, expenditure)

# clean type
pacsub$org <- as.factor(pacsub$org)
pacsub$spe_nam <- as.character(pacsub$spe_nam)
pacsub$rec_dat <- as.Date(pacsub$rec_dat, "%m/%d/%Y")

# remove obs < feb 2016 (same as campaign data summary)
pacsub <- pacsub[pacsub$rec_dat >= "2016-02-01",]

# create summary var for direction of effort
pacsub$direction[pacsub$org =="DJT_Support" | pacsub$org =="HRC_Oppose"] <- "Trump"
pacsub$direction[pacsub$org =="DJT_Oppose" | pacsub$org =="HRC_Support"] <- "Clinton"

#clean house in RStudio env
rm(pacsubHC); rm(pacsubDT); rm(rmdjt); rm(rmhrc)
```

#### Exploring PAC Data

```{r}
ggplot(pacsub, aes(x=direction, y=expenditure, fill=org)) +
    stat_summary(fun.y = sum, geom = "bar") + 
    ylab("Total Disbursements") + xlab("") + 
    ggtitle("Total Disbursements by Org Type") 

length(unique(pacsub$spe_nam))
```

### Relevant summary statistics 

**Provide summary statistics relevant to your research question. For example, if youâ€™re comparing means across groups provide means, SDs, sample sizes of each group. This step requires the use of R, hence a code chunk is provided below. Insert more code chunks as needed.**

## Part 4 - Inference:


## Part 5 - Conclusion: 


## References:


## Appendix (optional):

Remove this section if you don't have an appendix
